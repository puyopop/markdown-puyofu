<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ã·ã‚ˆã·ã‚ˆè¨˜æ³• SVGå¤‰æ›ãƒ„ãƒ¼ãƒ«</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 20px;
        font-size: 28px;
      }
      .explanation {
        background-color: #fffaed;
        border-left: 4px solid #ffd980;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 0 4px 4px 0;
      }
      .explanation h2 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 18px;
        display: flex;
        align-items: center;
      }
      .explanation h2 .icon {
        margin-right: 8px;
      }
      .explanation ul {
        margin-top: 10px;
        padding-left: 25px;
      }
      .explanation li {
        margin-bottom: 6px;
      }
      .color-samples {
        margin-top: 15px;
        display: flex;
        align-items: center;
      }
      .color-sample {
        display: inline-flex;
        align-items: center;
        margin-right: 10px;
      }
      .color-circle {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        margin-right: 5px;
        display: inline-block;
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      textarea {
        width: 100%;
        height: 200px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-family: monospace;
        resize: vertical;
      }
      .buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }
      button {
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        border: none;
      }
      .convert-btn {
        background-color: #4285f4;
        color: white;
      }
      .download-btn {
        background-color: #4caf50;
        color: white;
      }
      .convert-btn:hover {
        background-color: #3367d6;
      }
      .download-btn:hover {
        background-color: #3d8b40;
      }
      .tabs {
        display: flex;
        margin-bottom: 0;
        border-bottom: 1px solid #ddd;
      }
      .tab {
        padding: 8px 16px;
        cursor: pointer;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-bottom: none;
        margin-right: 5px;
        border-radius: 4px 4px 0 0;
      }
      .tab.active {
        background-color: #fff;
        border-bottom-color: white;
        position: relative;
        z-index: 1;
      }
      .output {
        margin-top: 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 4px 4px;
        background-color: #f9f9f9;
        min-height: 200px;
      }
      #svgOutput {
        text-align: center;
      }
      #svgCode {
        width: 100%;
        height: 150px;
        font-family: monospace;
        white-space: pre;
        overflow: auto;
        border: none;
        background: transparent;
        resize: vertical;
      }
      .example-container {
        margin-top: 30px;
      }
      .example-container h2 {
        font-size: 18px;
        margin-bottom: 15px;
      }
      .example {
        cursor: pointer;
        margin-bottom: 10px;
        padding: 10px;
        background-color: #e6f3ff;
        border-radius: 4px;
        transition: background-color 0.3s;
      }
      .example:hover {
        background-color: #d0e8ff;
      }
      .copied {
        background-color: #e6ffe6;
        transition: background-color 0.3s;
      }
    </style>
    <!-- SVG.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è¿½åŠ  -->
    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>ã·ã‚ˆã·ã‚ˆè¨˜æ³• SVGå¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>
      
      <div class="explanation">
        <h2><span class="icon">ğŸ“</span>è¨˜æ³•ã«ã¤ã„ã¦</h2>
        <p>åŸºæœ¬çš„ãªæ›¸ãæ–¹ï¼š</p>
        <ul>
          <li><strong>> RB</strong> ã§é…ã·ã‚ˆã‚’æŒ‡å®šï¼ˆR=èµ¤ã€G=ç·‘ã€B=é’ã€Y=é»„ã€P=ç´«ï¼‰</li>
          <li>å°æ–‡å­—(<strong>r, g, b</strong>ãªã©)ã§æ·¡ã„è‰²</li>
          <li>æ•°å­—(<strong>1-9</strong>)ã‚„ä¸¸æ•°å­—(<strong>â‘ -â‘¨</strong>)ã‚‚ä½¿ç”¨å¯èƒ½</li>
          <li><strong>v</strong> çŸ¢å°è¨˜å·ã‚‚ä½¿ç”¨å¯èƒ½ï¼ˆè½ä¸‹æ–¹å‘ã®æŒ‡ç¤ºãªã©ã«ï¼‰</li>
          <li><strong># ã‚³ãƒ¡ãƒ³ãƒˆ</strong> ã§å§‹ã¾ã‚‹è¡Œã¯ã‚³ãƒ¡ãƒ³ãƒˆè¡Œï¼ˆè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ï¼‰</li>
          <li><strong>---</strong> ã§æ¬¡ã®çŠ¶æ…‹ã¸</li>
          <li>ç©ºè¡Œã¯ç„¡è¦–ã•ã‚Œã¾ã™</li>
        </ul>
        <div class="color-samples">
          è‰²ã‚µãƒ³ãƒ—ãƒ«ï¼š
          <div class="color-sample"><span class="color-circle" style="background-color: #FF6B6B;"></span>R</div>
          <div class="color-sample"><span class="color-circle" style="background-color: #4CAF50;"></span>G</div>
          <div class="color-sample"><span class="color-circle" style="background-color: #5D9CEC;"></span>B</div>
          <div class="color-sample"><span class="color-circle" style="background-color: #FFCE54;"></span>Y</div>
          <div class="color-sample"><span class="color-circle" style="background-color: #AC92EC;"></span>P</div>
          <div class="color-sample"><span class="color-circle" style="background-color: #FFCDD2;"></span>r</div>
          <div class="color-sample"><span class="color-circle" style="background-color: #C8E6C9;"></span>g</div>
          <div class="color-sample"><span class="color-circle" style="background-color: #BBDEFB;"></span>b</div>
          <div class="color-sample"><span class="color-circle" style="background-color: #FFF9C4;"></span>y</div>
          <div class="color-sample"><span class="color-circle" style="background-color: #E1BEE7;"></span>p</div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="puyoInput">ã·ã‚ˆã·ã‚ˆè¨˜æ³•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š</label>
        <textarea id="puyoInput">#ä¾‹ï¼š
> RB
> GY

......
......
......
RR....

---

> GY
> BP

......
......
......
RRG...

---

> BP
> RR

......
......
......
RRGY..</textarea>
      </div>
      
      <div class="buttons">
        <button id="convertButton" class="convert-btn">SVGã«å¤‰æ›</button>
        <button id="downloadButton" class="download-btn">SVGã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
      </div>
      
      <div class="tabs">
        <div id="previewTab" class="tab active">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        <div id="codeTab" class="tab">SVGã‚³ãƒ¼ãƒ‰</div>
      </div>
      
      <div id="outputContainer" class="output">
        <div id="svgOutput"></div>
        <textarea id="svgCode" style="display: none;"></textarea>
      </div>
      
      <div class="example-container">
        <h2>ã‚µãƒ³ãƒ—ãƒ«è¨˜æ³•ï¼š</h2>
        <div class="example" onclick="setExample(1)">
          ä¾‹1: åŸºæœ¬çš„ãªé€£é–
        </div>
        <div class="example" onclick="setExample(2)">
          ä¾‹2: GTR
        </div>
        <div class="example" onclick="setExample(3)">
          ä¾‹3: æ·¡ã„è‰²ã¨æ•°å­—ã®æ´»ç”¨
        </div>
      </div>
    </div>

    <script>
      // PuyoPuyoRendererã‚¯ãƒ©ã‚¹
      class PuyoPuyoRenderer {
        constructor() {
          this.colors = {
            'R': '#FF6B6B', // èµ¤
            'G': '#4CAF50', // ç·‘
            'B': '#5D9CEC', // é’
            'Y': '#FFCE54', // é»„è‰²
            'P': '#AC92EC', // ç´«
            'r': '#FFCDD2', // æ·¡ã„èµ¤
            'g': '#C8E6C9', // æ·¡ã„ç·‘
            'b': '#BBDEFB', // æ·¡ã„é’
            'y': '#FFF9C4', // æ·¡ã„é»„è‰²
            'p': '#E1BEE7', // æ·¡ã„ç´«
            '.': '#F5F5F5', // ç©ºç™½
            'v': '#FFFFFF'  // ä¸‹çŸ¢å°            
          };
          
          // æ•°å­—ã‚‚ã‚µãƒãƒ¼ãƒˆ
          for (let i = 1; i <= 9; i++) {
            this.colors[i.toString()] = '#AAAAAA';  // æ•°å­—ã¯ç°è‰²
          }
          
          this.cellSize = 30; // ã·ã‚ˆã®ã‚»ãƒ«ã‚µã‚¤ã‚º(px)
        }
        
        renderToSVG(text) {
          // æ”¹è¡Œã§åŒºåˆ‡ã‚‰ã‚ŒãŸ "---" ã‚’æ­£è¦è¡¨ç¾ã§æ¤œå‡ºã—ã¦åˆ†å‰²
          const sections = text.split(/\n\s*---\s*\n/).map(s => s.trim()).filter(s => s);
          
          // å…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æœ€å¤§å¹…ã¨ç·é«˜ã•ã‚’è¨ˆç®—
          const sectionData = sections.map(section => {
            const lines = section.split('\n').map(l => l.trim()).filter(l => l);
            
            // ç›¤é¢ã¨ãƒã‚¯ã‚¹ãƒˆã‚’åˆ†é›¢
            const nextPuyos = [];
            const field = [];
            
            lines.forEach(line => {
              // ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
              if (line.startsWith('#')) {
                return;
              } else if (line.startsWith('>')) {
                nextPuyos.push(line.substring(1).trim());
              } else {
                field.push(line);
              }
            });
            
            // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¹…ï¼ˆæœ€ã‚‚é•·ã„è¡Œã‹ã‚‰æ±ºå®šï¼‰
            const fieldWidth = field.length > 0 ? Math.max(...field.map(line => line.length)) : 0;
            
            return {
              nextPuyos,
              field,
              fieldWidth,
              height: nextPuyos.length + field.length
            };
          });
          
          const maxWidth = Math.max(...sectionData.map(d => d.fieldWidth), 6); // æœ€å°å¹…6ï¼ˆæ¨™æº–ã·ã‚ˆã·ã‚ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¹…ï¼‰
          let totalHeight = sectionData.reduce((sum, d, i) => 
            sum + d.height + (i < sectionData.length - 1 ? 1 : 0), 0);
          
          // SVGã®å…¨ä½“ã‚µã‚¤ã‚º
          const svgWidth = maxWidth * this.cellSize;
          const svgHeight = totalHeight * this.cellSize;
          
          // SVG.jsã‚’ä½¿ç”¨ã—ãŸSVGç”Ÿæˆ
          const svgContainer = document.createElement('div');
          const draw = SVG().addTo(svgContainer).size(svgWidth, svgHeight).viewbox(0, 0, svgWidth, svgHeight);
          
          // ãƒ‘ã‚¿ãƒ¼ãƒ³å®šç¾©
          const defs = draw.defs();
          const pattern = defs.pattern(10, 10, function(add) {
            add.rect(10, 10).fill('#f8f8f8');
            add.line(0, 0, 0, 10).stroke({ color: '#eeeeee', width: 2 });
          }).transform({ rotate: 45 }).id('nextPattern');
          
          let yOffset = 0;
          
          sections.forEach((section, sectionIndex) => {
            const { nextPuyos, field } = sectionData[sectionIndex];
            
            // ãƒã‚¯ã‚¹ãƒˆã·ã‚ˆã®èƒŒæ™¯ã‚’æç”»
            if (nextPuyos.length > 0) {
              const nextHeight = nextPuyos.length * this.cellSize;
              const nextWidth = maxWidth * this.cellSize;
              draw.rect(nextWidth, nextHeight)
                .move(0, yOffset * this.cellSize)
                .fill('url(#nextPattern)')
                .stroke({ color: '#cccccc', width: 1 });
              
              // ãƒã‚¯ã‚¹ãƒˆã·ã‚ˆã®ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
              draw.text('NEXT')
                .move(5, yOffset * this.cellSize + 15)
                .font({
                  family: 'sans-serif',
                  size: 12,
                  weight: 'bold'
                }).fill('#888888');
            }
            
            // ãƒã‚¯ã‚¹ãƒˆã·ã‚ˆã‚’æç”»
            nextPuyos.forEach((pair, i) => {
              for (let j = 0; j < pair.length; j++) {
                const puyo = pair[j];
                if (puyo !== ' ') {
                  const cx = j * this.cellSize + this.cellSize / 2;
                  const cy = yOffset * this.cellSize + this.cellSize / 2;
                  const color = this.colors[puyo] || this.colors['.'];
                  
                  if (puyo === 'v') {
                    // çŸ¢å°ã®å ´åˆã¯ç‰¹åˆ¥ãªæç”»
                    draw.text(puyo)
                      .move(cx, cy)
                      .font({
                        family: 'sans-serif',
                        size: this.cellSize * 0.8,
                        weight: 'bold'
                      })
                      .fill('#555')
                      .center(cx, cy);
                  } else {
                    // é€šå¸¸ã®ã·ã‚ˆ
                    draw.circle(this.cellSize - 2)
                      .center(cx, cy)
                      .fill(color)
                      .stroke({ color: '#999', width: 0.5 });
                    draw.text(puyo)
                      .move(cx, cy)
                      .font({
                        family: 'monospace',
                        size: this.cellSize / 2
                      })
                      .fill('#555')
                      .center(cx, cy);
                  }
                }
              }
              yOffset++;
            });
            
            // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èƒŒæ™¯ã‚’æç”»
            if (field.length > 0) {
              const fieldHeight = field.length * this.cellSize;
              const fieldWidth = maxWidth * this.cellSize;
              draw.rect(fieldWidth, fieldHeight)
                .move(0, yOffset * this.cellSize)
                .fill('#ffffff')
                .stroke({ color: '#aaaaaa', width: 1 });
              
              // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
              draw.text('FIELD')
                .move(5, yOffset * this.cellSize + 15)
                .font({
                  family: 'sans-serif',
                  size: 12,
                  weight: 'bold'
                }).fill('#888888');
            }
            
            // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æç”»
            field.forEach((row, i) => {
              for (let j = 0; j < row.length; j++) {
                const puyo = row[j];
                const cx = j * this.cellSize + this.cellSize / 2;
                const cy = yOffset * this.cellSize + this.cellSize / 2;
                const color = this.colors[puyo] || this.colors['.'];
                
                if (puyo === 'v') {
                  // çŸ¢å°ã®å ´åˆã¯ç‰¹åˆ¥ãªæç”»
                  draw.text('â†“')
                    .move(cx, cy)
                    .font({
                      family: 'sans-serif',
                      size: this.cellSize * 0.8,
                      weight: 'bold'
                    })
                    .fill('#555')
                    .center(cx, cy);
                } else {
                  // é€šå¸¸ã®ã·ã‚ˆ
                  draw.circle(this.cellSize - 2)
                    .center(cx, cy)
                    .fill(color)
                    .stroke({ color: '#333', width: 1 });
                  draw.text(puyo)
                    .move(cx, cy)
                    .font({
                      family: 'monospace',
                      size: this.cellSize / 2
                    })
                    .fill('#000')
                    .center(cx, cy);
                }
              }
              yOffset++;
            });
            
            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®åŒºåˆ‡ã‚Šï¼ˆæœ€å¾Œã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä»¥å¤–ï¼‰
            if (sectionIndex < sections.length - 1) {
              draw.line(0, yOffset * this.cellSize, svgWidth, yOffset * this.cellSize)
                .stroke({ color: '#888', width: 2, dasharray: '5,3' });
              yOffset++;
            }
          });
          
          return svgContainer.innerHTML;
        }
      }

      // ç¾åœ¨ã®ã‚¿ãƒ–ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¾ãŸã¯ã‚³ãƒ¼ãƒ‰ï¼‰
      let currentTab = 'preview';
      let currentSvg = '';
      
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
      document.getElementById('convertButton').addEventListener('click', convertToSVG);
      document.getElementById('downloadButton').addEventListener('click', downloadSVG);
      document.getElementById('previewTab').addEventListener('click', () => switchTab('preview'));
      document.getElementById('codeTab').addEventListener('click', () => switchTab('code'));
      
      // SVGã¸å¤‰æ›ã™ã‚‹é–¢æ•°
      function convertToSVG() {
        const puyoNotation = document.getElementById('puyoInput').value;
        
        if (!puyoNotation.trim()) {
          alert('ã·ã‚ˆã·ã‚ˆè¨˜æ³•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        
        // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®å‡¦ç†
        const renderer = new PuyoPuyoRenderer();
        currentSvg = renderer.renderToSVG(puyoNotation);
        
        document.getElementById('svgOutput').innerHTML = currentSvg;
        document.getElementById('svgCode').value = currentSvg;
        
        // ç¾åœ¨ã®ã‚¿ãƒ–ã‚’åæ˜ 
        switchTab(currentTab);
      }
      
      // SVGã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹é–¢æ•°
      function downloadSVG() {
        if (!currentSvg) {
          alert('å…ˆã«SVGã«å¤‰æ›ã—ã¦ãã ã•ã„');
          return;
        }
        
        const blob = new Blob([currentSvg], {type: 'image/svg+xml'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'puyopuyo.svg';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
      
      // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
      function switchTab(tab) {
        currentTab = tab;
        
        // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
        document.getElementById('previewTab').className = tab === 'preview' ? 'tab active' : 'tab';
        document.getElementById('codeTab').className = tab === 'code' ? 'tab active' : 'tab';
        
        // å¯¾å¿œã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
        if (tab === 'preview') {
          document.getElementById('svgOutput').style.display = 'block';
          document.getElementById('svgCode').style.display = 'none';
        } else {
          document.getElementById('svgOutput').style.display = 'none';
          document.getElementById('svgCode').style.display = 'block';
        }
      }
      
      // ã‚µãƒ³ãƒ—ãƒ«ä¾‹ã®è¨­å®š
      function setExample(number) {
        let example = '';
        
        if (number === 1) {
          example = `> RB
> GY

......
......
......
RR....

---

> GY
> BP

......
......
......
RRG...

---

> BP
> RR

......
......
......
RRGY..`;
        } else if (number === 2) {
          example = `> GR
> BY

......
......
......
......
......

---

> BY
> RR

......
......
......
......
G.....

---

> RR
> GB

......
......
......
......
GR....

---

> GB
> YR

......
......
......
......
GRB...

---

> YR
> BG

......
......
......
......
GRBY..`;
        } else if (number === 3) {
          example = `> Rr
> Gg

......
......
......
1234..

---

> Bb
> Yy

......
......
......
1234r.

---

> Pp
> 56

......
......
......
1234rg`;
        }
        
        document.getElementById('puyoInput').value = example;
        
        // ä¾‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸéš›ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
        const elements = document.getElementsByClassName('example');
        for (let i = 0; i < elements.length; i++) {
          elements[i].classList.remove('copied');
        }
        event.currentTarget.classList.add('copied');
        setTimeout(function() {
          event.currentTarget.classList.remove('copied');
        }, 500);
      }
    </script>
  </body>
</html>